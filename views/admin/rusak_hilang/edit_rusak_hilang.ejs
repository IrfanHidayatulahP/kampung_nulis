<%- include('../../partials/header.ejs') %>

    <div class="container mt-4">
        <h2>Edit Rusak / Hilang — ID #<%= record.id_rusak_hilang %>
        </h2>

        <% if (typeof error !=='undefined' && error) { %>
            <div class="alert alert-danger">
                <%= error %>
            </div>
            <% } %>
                <% if (typeof success !=='undefined' && success) { %>
                    <div class="alert alert-success">
                        <%= success %>
                    </div>
                    <% } %>

                        <form method="post" action="/rusak-hilang/edit/<%= record.id_rusak_hilang %>">
                            <div class="mb-3">
                                <label class="form-label">ID Detail (transaksi)</label>
                                <select name="id_detail" class="form-control" required>
                                    <% if (detailOptions && detailOptions.length) { %>
                                        <% detailOptions.forEach(function(d) { %>
                                            <option value="<%= d.id_detail %>" <%=d.id_detail===record.id_detail
                                                ? 'selected' : '' %>><%= d.id_detail %> — transaksi: <%= d.id_transaksi
                                                        || '-' %>
                                            </option>
                                            <% }) %>
                                                <% } else { %>
                                                    <option value="<%= record.id_detail %>">
                                                        <%= record.id_detail %>
                                                    </option>
                                                    <% } %>
                                </select>
                                <small class="form-text text-muted">Mengubah ID detail akan mempengaruhi perhitungan
                                    biaya otomatis.</small>
                            </div>

                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Nama Barang</label>
                                    <input type="text" class="form-control" value="<%= record.nama_barang || '-' %>"
                                        readonly>
                                </div>

                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Jumlah Rusak</label>
                                    <input type="number" name="jumlah_rusak" class="form-control" min="0"
                                        value="<%= record.jumlah_rusak || 0 %>">
                                </div>

                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Jumlah Hilang</label>
                                    <input type="number" name="jumlah_hilang" class="form-control" min="0"
                                        value="<%= record.jumlah_hilang || 0 %>">
                                </div>

                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Biaya Denda per Item (dipakai)</label>
                                    <input type="text" class="form-control"
                                        value="Rp <%= (record.biaya_denda_per_item || 0).toLocaleString('id-ID') %>"
                                        readonly>
                                    <small class="form-text text-muted">Biaya ini dihitung otomatis (bisa berasal dari
                                        ganti_barang atau harga dasar sewa).</small>
                                </div>
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-success">Update</button>
                                <a href="/rusak-hilang/list" class="btn btn-secondary">Batal</a>
                            </div>
                        </form>
    </div>

    <%- include('../../partials/footer.ejs') %>