<%- include('../../partials/header.ejs') %>

    <div class="container" style="padding: 0 10px 10px 10px; max-width: 1200px; margin: 0 auto;">
        <% const fmt=(v)=> {
            try { return Number(v || 0).toLocaleString('id-ID'); }
            catch (e) { return '0'; }
            };
            %>

            <div class="container detail-page">

                <!-- ================= HEADER ================= -->
                <div class="detail-header">
                    <h2>üìÑ Detail Transaksi</h2>
                    <a href="/sewa/list-sewa" class="btn-back">‚Üê Kembali</a>
                </div>

                <!-- ================= INFO TRANSAKSI ================= -->
                <div class="trx-info-card">
                    <div class="info-row">
                        <span>ID Transaksi</span>
                        <strong>#<%= transaksi.id_transaksi %></strong>
                    </div>
                    <div class="info-row">
                        <span>Nama Peminjam</span>
                        <strong>
                            <%= nama_lengkap || user.username %>
                        </strong>
                    </div>
                    <div class="info-row">
                        <span>Tanggal Sewa</span>
                        <strong>
                            <%= transaksi.tgl_sewa ? new Date(transaksi.tgl_sewa).toLocaleDateString('id-ID') : '-' %>
                        </strong>
                    </div>
                    <div class="info-row">
                        <span>Tanggal Kembali</span>
                        <strong>
                            <%= transaksi.tgl_pengembalian ? new
                                Date(transaksi.tgl_pengembalian).toLocaleDateString('id-ID') : '-' %>
                        </strong>
                    </div>
                    <div class="info-row">
                        <span>Status</span>
                        <span class="badge badge-<%= transaksi.status_transaksi %>">
                            <%= transaksi.status_transaksi.toUpperCase() %>
                        </span>
                    </div>
                    <div class="info-row total">
                        <span>Total Biaya</span>
                        <strong>Rp <%= fmt(transaksi.total_biaya_sewa) %></strong>
                    </div>
                </div>

                <!-- ================= LIST BARANG ================= -->
                <div class="detail-items">
                    <h3>üß∞ Daftar Barang Disewa</h3>

                    <% if (details && details.length> 0) { %>
                        <% details.forEach(item=> {
                            const barang = item.barang || item.id_barang_barang || {};
                            const subtotal = item.total_harga_sewa || (item.jumlah_sewa * item.harga_sewa_per_satuan);
                            %>

                            <div class="item-card">
                                <div class="item-img">
                                    <% if (barang.photo_path) { %>
                                        <img src="<%= barang.photo_path %>" alt="<%= barang.nama_barang %>">
                                        <% } else { %>
                                            <div class="no-img">No Image</div>
                                            <% } %>
                                </div>

                                <div class="item-info">
                                    <h4>
                                        <%= barang.nama_barang || 'Barang Tidak Diketahui' %>
                                    </h4>
                                    <p>Harga: Rp <%= fmt(item.harga_sewa_per_satuan) %> / hari</p>
                                    <p>Jumlah: <strong>
                                            <%= item.jumlah_sewa %>
                                        </strong></p>
                                </div>

                                <div class="item-subtotal">
                                    Rp <%= fmt(subtotal) %>
                                </div>
                            </div>

                            <% }) %>
                                <% } else { %>
                                    <p class="text-muted">Tidak ada barang dalam transaksi ini.</p>
                                    <% } %>
                </div>

            </div>
    </div>

    <style>
        .container {
            padding: 0px 10px 10px 10px !important;
            /* Mengurangi jarak atas */
            max-width: 1200px;
            margin: 0 auto;
        }

        .detail-page {
            max-width: 1000px;
            margin: auto;
            padding: 20px;
        }

        /* ===== HEADER ===== */
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .btn-back {
            text-decoration: none;
            color: #2563eb;
            font-weight: bold;
        }

        /* ===== TRANSAKSI INFO ===== */
        .trx-info-card {
            background: #fff;
            border-radius: 14px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            margin-bottom: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .info-row.total {
            border-top: 1px dashed #cbd5e1;
            margin-top: 10px;
            padding-top: 12px;
            font-size: 1.05rem;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: bold;
            color: white;
        }

        .badge-aktif {
            background: #2563eb;
        }

        .badge-disewa {
            background: #16a34a;
        }

        .badge-selesai {
            background: #16a34a;
        }

        .badge-terlambat {
            background: #dc2626;
        }

        /* ===== ITEMS ===== */
        .detail-items h3 {
            margin-bottom: 15px;
        }

        .item-card {
            background: #fff;
            border-radius: 14px;
            padding: 16px;
            display: grid;
            grid-template-columns: 90px 1fr 140px;
            gap: 16px;
            align-items: center;
            border: 1px solid #e5e7eb;
            margin-bottom: 16px;
        }

        .item-img {
            width: 90px;
            height: 90px;
            background: #f1f5f9;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .item-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .no-img {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .item-info h4 {
            margin: 0 0 6px;
        }

        .item-subtotal {
            text-align: right;
            font-weight: bold;
        }

        /* ===== MOBILE ===== */
        @media (max-width: 768px) {
            .item-card {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .item-subtotal {
                text-align: center;
            }
        }
    </style>

    <%- include('../../partials/footer.ejs') %>